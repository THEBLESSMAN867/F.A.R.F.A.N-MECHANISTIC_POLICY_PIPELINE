{
  "identity": {
    "base_slot": "D1-Q1",
    "question_id": "Q001",
    "dimension_id": "DIM01",
    "policy_area_id": "PA01",
    "contract_version": "1.0.0",
    "contract_hash": "TODO_COMPUTE_SHA256_OF_THIS_FILE",
    "created_at": "2025-11-24T00:00:00Z",
    "validated_against_schema": "executor_contract.v2.schema.json"
  },
  "executor_binding": {
    "executor_class": "D1Q1_Executor_Contract",
    "executor_module": "saaaaaa.core.orchestrator.executors_contract"
  },
  "method_binding": {
    "method_id": "TODO_METHOD_ID_FROM_METHOD_MAP",
    "class_name": "Dimension1Analyzer",
    "method_name": "analyze_question_1",
    "method_signature": {
      "params": [
        "preprocessed_document",
        "question_context",
        "signal_pack"
      ],
      "returns": "Phase2QuestionResult"
    }
  },
  "question_context": {
    "question_text": "¿El diagnóstico presenta datos numéricos (tasas de VBG, porcentajes de participación, cifras de brechas salariales) para el área de Derechos de las mujeres e igualdad de género que sirvan como línea base? Se debe verificar la presencia de un año de referencia y la mención de fuentes (ej. DANE, Medicina Legal, Observatorio de Género).",
    "question_type": "micro",
    "scoring_modality": "TYPE_A",
    "modality": "count_and_scale",
    "expected_output_type": "score",
    "patterns": [
      {
        "category": "TEMPORAL",
        "confidence_weight": 0.85,
        "flags": "i",
        "id": "PAT-Q001-000",
        "match_type": "REGEX",
        "pattern": "línea base|año base|situación inicial|diagnóstico de género"
      },
      {
        "category": "GENERAL",
        "confidence_weight": 0.85,
        "flags": "i",
        "id": "PAT-Q001-001",
        "match_type": "REGEX",
        "pattern": "fuente:|según|reportado por|con datos de"
      },
      {
        "category": "FUENTE_OFICIAL",
        "confidence_weight": 0.85,
        "flags": "i",
        "id": "PAT-Q001-002",
        "match_type": "REGEX",
        "pattern": "DANE|Medicina Legal|Fiscalía|Policía Nacional|SIVIGILA|SISPRO"
      },
      {
        "category": "GENERAL",
        "confidence_weight": 0.85,
        "flags": "i",
        "id": "PAT-Q001-003",
        "match_type": "REGEX",
        "pattern": "Observatorio de Asuntos de Género|Secretaría de la Mujer|Comisaría de Familia"
      },
      {
        "category": "GENERAL",
        "confidence_weight": 0.85,
        "flags": "i",
        "id": "PAT-Q001-004",
        "match_type": "REGEX",
        "pattern": "Encuesta Nacional de Demografía y Salud|ENDS"
      },
      {
        "category": "GENERAL",
        "confidence_weight": 0.85,
        "flags": "i",
        "id": "PAT-Q001-005",
        "match_type": "REGEX",
        "pattern": "violencia intrafamiliar|VBG|violencia basada en género|delitos sexuales|feminicidio"
      },
      {
        "category": "INDICADOR",
        "confidence_weight": 0.85,
        "flags": "i",
        "id": "PAT-Q001-006",
        "match_type": "REGEX",
        "pattern": "tasa de|porcentaje de|número de casos|brecha salarial de"
      },
      {
        "category": "GENERAL",
        "confidence_weight": 0.85,
        "flags": "i",
        "id": "PAT-Q001-007",
        "match_type": "REGEX",
        "pattern": "participación política de las mujeres|mujeres en cargos directivos"
      },
      {
        "category": "INDICADOR",
        "confidence_weight": 0.85,
        "flags": "i",
        "id": "PAT-Q001-008",
        "match_type": "REGEX",
        "pattern": "autonomía económica|tasa de desempleo femenina"
      },
      {
        "category": "GENERAL",
        "confidence_weight": 0.85,
        "flags": "i",
        "id": "PAT-Q001-009",
        "match_type": "REGEX",
        "pattern": "madres adolescentes|embarazo en adolescentes"
      },
      {
        "category": "GENERAL",
        "confidence_weight": 0.85,
        "flags": "i",
        "id": "PAT-Q001-010",
        "match_type": "LITERAL",
        "pattern": "2021|2022|2023|vigencia anterior|cuatrienio anterior"
      },
      {
        "category": "INDICADOR",
        "confidence_weight": 0.85,
        "flags": "i",
        "id": "PAT-Q001-011",
        "match_type": "REGEX",
        "pattern": "\\d+(\\.\\d+)?\\s*%"
      },
      {
        "category": "UNIDAD_MEDIDA",
        "confidence_weight": 0.85,
        "flags": "i",
        "id": "PAT-Q001-012",
        "match_type": "REGEX",
        "pattern": "por cada 100\\.000 mujeres|por 100 mil habitantes"
      },
      {
        "category": "TEMPORAL",
        "confidence_weight": 0.85,
        "flags": "i",
        "id": "PAT-Q001-013",
        "match_type": "REGEX",
        "pattern": "serie histórica|evolución 20\\d{2}-20\\d{2}|tendencia de los últimos"
      }
    ],
    "expected_elements": [
      {
        "required": true,
        "type": "cobertura_territorial_especificada"
      },
      {
        "minimum": 2,
        "type": "fuentes_oficiales"
      },
      {
        "minimum": 3,
        "type": "indicadores_cuantitativos"
      },
      {
        "minimum": 3,
        "type": "series_temporales_años"
      }
    ],
    "validations": {
      "buscar_indicadores_cuantitativos": {
        "minimum_required": 3,
        "patterns": [
          "\\d+%",
          "\\d+\\s*por\\s*\\d+",
          "tasa de",
          "índice de",
          "cobertura de"
        ],
        "specificity": "HIGH"
      },
      "cobertura": {
        "minimum_required": 1,
        "patterns": [
          "departamental",
          "municipal",
          "urbano",
          "rural",
          "territorial",
          "poblacional"
        ],
        "specificity": "HIGH"
      },
      "series_temporales": {
        "minimum_years": 3,
        "patterns": [
          "20\\d{2}",
          "año",
          "periodo",
          "histórico",
          "serie"
        ],
        "specificity": "HIGH"
      }
    }
  },
  "signal_requirements": {
    "mandatory_signals": [],
    "optional_signals": [],
    "signal_aggregation": "weighted_mean",
    "minimum_signal_threshold": 0.0,
    "note": "Signal requirements are currently under development. Signal IDs will be populated once the signal_registry provides a canonical mapping for PA01/DIM01."
  },
  "evidence_assembly": {
    "module": "saaaaaa.core.orchestrator.evidence_assembler",
    "class_name": "EvidenceAssembler",
    "method_name": "assemble",
    "output_schema": {
      "type": "object",
      "required": [
        "elements",
        "raw_results"
      ],
      "properties": {
        "elements": {
          "type": "array",
          "description": "Lista de elementos de evidencia encontrados para esta micro-pregunta."
        },
        "raw_results": {
          "type": "object",
          "properties": {
            "confidence_scores": {
              "type": "array",
              "description": "Scores de confianza usados por el scorer."
            },
            "semantic_similarity": {
              "description": "Métrica de similitud semántica (si aplica)."
            },
            "pattern_matches": {
              "type": "object",
              "description": "Matches de patrones esperados vs texto."
            },
            "metadata": {
              "type": "object",
              "description": "Metadatos arbitrarios pasados al scorer."
            }
          },
          "additionalProperties": true
        }
      },
      "additionalProperties": true
    },
    "assembly_rules": [
      {
        "target": "elements_found",
        "sources": [
          "primary_analysis.elements",
          "validation_analysis.validated_elements"
        ],
        "merge_strategy": "concat",
        "description": "Combine all unique elements found from both analysis and validation stages."
      },
      {
        "target": "confidence_scores",
        "sources": [
          "primary_analysis.confidences"
        ],
        "merge_strategy": "first",
        "default": [],
        "description": "Use the confidence scores from the primary analysis."
      },
      {
        "target": "pattern_matches",
        "sources": [
          "primary_analysis.patterns"
        ],
        "merge_strategy": "first",
        "default": {},
        "description": "Use the pattern match details from the primary analysis."
      },
      {
        "target": "metadata",
        "sources": [
          "primary_analysis.metadata",
          "validation_analysis.metadata"
        ],
        "merge_strategy": "concat",
        "description": "Combine metadata from all method steps for full traceability."
      }
    ]
  },
  "output_contract": {
    "result_type": "Phase2QuestionResult",
    "schema": {
      "type": "object",
      "required": [
        "base_slot",
        "question_id",
        "question_global",
        "evidence",
        "validation"
      ],
      "properties": {
        "base_slot": {
          "type": "string",
          "description": "Debe coincidir con identity.base_slot.",
          "const": "D1-Q1"
        },
        "question_id": {
          "type": "string",
          "description": "Debe coincidir con identity.question_id.",
          "const": "Q001"
        },
        "question_global": {
          "type": "integer",
          "description": "Índice global de la pregunta (de questionnaire_monolith).",
          "const": 1
        },
        "policy_area_id": {
          "type": [
            "string",
            "null"
          ],
          "description": "PA canónica, debe ser coherente con identity.policy_area_id.",
          "const": "PA01"
        },
        "dimension_id": {
          "type": [
            "string",
            "null"
          ],
          "description": "Dimensión canónica, coherente con identity.dimension_id.",
          "const": "DIM01"
        },
        "cluster_id": {
          "type": [
            "string",
            "null"
          ],
          "description": "Cluster de análisis según el monolith, si aplica.",
          "const": "CL02"
        },
        "evidence": {
          "type": [
            "object",
            "null"
          ],
          "description": "Objeto de evidencia ensamblado por el EvidenceAssembler; debe cumplir evidence_assembly.output_schema.",
          "additionalProperties": true
        },
        "validation": {
          "type": [
            "object",
            "null"
          ],
          "description": "Resultado de validaciones lógicas de la respuesta (coherencia, integridad, etc.).",
          "additionalProperties": true
        },
        "trace": {
          "type": [
            "object",
            "null"
          ],
          "description": "Información de trazabilidad (provenance, logs) específica de la ejecución.",
          "additionalProperties": true
        },
        "metadata": {
          "type": [
            "object",
            "null"
          ],
          "description": "Metadatos adicionales de la pregunta para consumo posterior.",
          "additionalProperties": true
        }
      },
      "additionalProperties": false
    },
    "consumer_modules": [
      "src.saaaaaa.core.phases.phase2_types.validate_phase2_result",
      "src.saaaaaa.core.orchestrator.core.Orchestrator._score_micro_results_async",
      "src.saaaaaa.analysis.scoring.MicroQuestionScorer"
    ]
  },
  "validation_rules": {
    "na_policy": "abort_on_critical",
    "rules": [
      {
        "field": "elements_found",
        "type": "array",
        "must_contain": {
          "count": 1,
          "elements": [
            "cobertura_territorial_especificada"
          ]
        },
        "description": "Derived from monolith `expected_elements` where `required` is true."
      },
      {
        "field": "elements_found",
        "type": "array",
        "should_contain": [
          {
            "elements": [
              "fuentes_oficiales"
            ],
            "minimum": 2
          },
          {
            "elements": [
              "indicadores_cuantitativos"
            ],
            "minimum": 3
          },
          {
            "elements": [
              "series_temporales_años"
            ],
            "minimum": 3
          }
        ],
        "description": "Derived from monolith `expected_elements` with `minimum` counts."
      }
    ]
  },
  "traceability": {
    "source_file": "data/questionnaire_monolith.json",
    "json_path": "blocks.micro_questions[0]",
    "ontology_source": "config/canonical_ontologies/policy_areas_and_dimensions.json",
    "source_hash": "TODO_SHA256_HASH_OF_QUESTIONNAIRE_MONOLITH",
    "contract_generation_method": "canonical_prompt_v2",
    "contract_author": "F.A.R.F.A.N Mechanistic Policy Pipeline",
    "provenance_note": "This contract was generated from the canonical questionnaire monolith following the executor contract v2 specification. All fields are traceable to their sources of truth."
  },
  "error_handling": {
    "on_method_not_found": "raise",
    "on_method_failure": "propagate_with_trace",
    "on_assembly_failure": "propagate_with_trace",
    "failure_contract": {
      "abort_if": [
        "missing_required_element",
        "incomplete_text"
      ],
      "emit_code": "ABORT-Q001-REQ"
    }
  },
  "fallback_strategy": {
    "use_llm_direct": false,
    "use_heuristics": false,
    "note": "No fallback strategies are enabled. All failures will propagate according to error_handling configuration."
  },
  "test_configuration": {
    "test_files": [
      "tests/core/orchestrator/test_executors_contract.py",
      "tests/core/phases/test_phase2.py"
    ],
    "test_document_fixtures": [
      "tests/fixtures/preprocessed_documents/sample_pdet_plan.json"
    ],
    "expected_test_coverage": ">=90%",
    "integration_test_required": true
  },
  "compatibility": {
    "orchestrator_min_version": "TODO_VERSION",
    "signal_registry_min_version": "TODO_VERSION",
    "method_executor_min_version": "TODO_VERSION",
    "questionnaire_monolith_version": "3.0.0",
    "phase2_types_version": "TODO_VERSION"
  },
  "calibration": {
    "status": "placeholder",
    "note": "Este contrato no embebe scores de calibración. La calibración real se gestiona vía src/saaaaaa/core/calibration/ + config/intrinsic_calibration.json + config/fusion_specification.json.",
    "source": {
      "intrinsic_calibration": "config/intrinsic_calibration.json",
      "fusion_specification": "config/fusion_specification.json",
      "layer_calibrations_dir": "config/layer_calibrations/",
      "canonical_spec": "canonic_calibration_methods.md"
    }
  }
}
